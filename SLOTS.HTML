<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slot Booking - Smart Parking</title>
    <link rel="stylesheet" href="STYLE.css">
</head>
<body>
    <div class="slots-container">
        <h2>Available Slots</h2>
        <form id="bookingForm">
            <label for="slot">Choose a Slot:</label>
            <select id="slot" required>
                <option value="1">Slot 1 - ₹50/day</option>
                <option value="2">Slot 2 - ₹70/day</option>
                <option value="3">Slot 3 - ₹100/day</option>
            </select>

            <label for="startDate">Start Date:</label>
            <input type="date" id="startDate" required>

            <label for="endDate">End Date:</label>
            <input type="date" id="endDate" required>

            <button type="submit">Proceed to Payment</button>
        </form>
    </div>
    <script src="script.js"></script>
    
    <!-- Firebase Integration -->
    <script type="module">
        // Import Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getDatabase, ref, set, get, update, onValue } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDIQOSfaxPNZ3S-QWkdCwvsqFS17YSl75Q",
            authDomain: "smartparking-83d14.firebaseapp.com",
            databaseURL: "https://smartparking-83d14-default-rtdb.firebaseio.com",
            projectId: "smartparking-83d14",
            storageBucket: "smartparking-83d14.appspot.com",
            messagingSenderId: "7613741307",
            appId: "1:7613741307:web:7bb54d907e5a9bf43fd85e",
            measurementId: "G-7NGPT6ZZ6T"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        const bookingForm = document.getElementById("bookingForm");
        const bookingMessage = document.getElementById("bookingMessage");

        // Monitor Slot Availability
        const slotDropdown = document.getElementById("slot");
        onValue(ref(database, "slots/"), (snapshot) => {
            const slots = snapshot.val();
            for (const slotId in slots) {
                const option = Array.from(slotDropdown.options).find(opt => opt.value === slotId);
                if (option) {
                    option.disabled = slots[slotId].status === "booked";
                }
            }
        });

        // Handle Booking Submission
        bookingForm.addEventListener("submit", async (e) => {
            e.preventDefault();

            const slot = document.getElementById("slot").value;
            const startDate = document.getElementById("startDate").value;
            const endDate = document.getElementById("endDate").value;

            // Check if the slot is still available
            const slotRef = ref(database, `slots/${slot}`);
            const snapshot = await get(slotRef);
            if (snapshot.exists() && snapshot.val().status === "booked") {
                bookingMessage.textContent = "Slot already booked! Please select another.";
                return;
            }

            // Update the database
            try {
                await update(slotRef, {
                    status: "booked",
                    bookingDetails: {
                        startDate,
                        endDate
                    }
                });
                bookingMessage.textContent = `Slot ${slot} successfully booked from ${startDate} to ${endDate}!`;
                setTimeout(() => {
                    bookingMessage.textContent = "";
                }, 5000);
            } catch (error) {
                console.error("Error booking slot:", error);
                bookingMessage.textContent = "Error occurred. Please try again.";
            }
        });
    </script>


</body>
</html>
